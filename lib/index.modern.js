import e,{Component as t}from"react";import r from"prop-types";import n from"react-fast-compare";import s from"invariant";import o from"shallowequal";const i={BASE:"base",BODY:"body",HEAD:"head",HTML:"html",LINK:"link",META:"meta",NOSCRIPT:"noscript",SCRIPT:"script",STYLE:"style",TITLE:"title",FRAGMENT:"Symbol(react.fragment)"},a=Object.keys(i).map(e=>i[e]),l={accesskey:"accessKey",charset:"charSet",class:"className",contenteditable:"contentEditable",contextmenu:"contextMenu","http-equiv":"httpEquiv",itemprop:"itemProp",tabindex:"tabIndex"},c=Object.keys(l).reduce((e,t)=>(e[l[t]]=t,e),{}),p=(e,t)=>{for(let r=e.length-1;r>=0;r-=1){const n=e[r];if(Object.prototype.hasOwnProperty.call(n,t))return n[t]}return null},d=e=>{let t=p(e,i.TITLE);const r=p(e,"titleTemplate");if(Array.isArray(t)&&(t=t.join("")),r&&t)return r.replace(/%s/g,()=>t);const n=p(e,"defaultTitle");return t||n||void 0},h=e=>p(e,"onChangeClientState")||(()=>{}),u=(e,t)=>t.filter(t=>void 0!==t[e]).map(t=>t[e]).reduce((e,t)=>({...e,...t}),{}),m=(e,t)=>t.filter(e=>void 0!==e[i.BASE]).map(e=>e[i.BASE]).reverse().reduce((t,r)=>{if(!t.length){const n=Object.keys(r);for(let s=0;s<n.length;s+=1){const o=n[s].toLowerCase();if(-1!==e.indexOf(o)&&r[o])return t.concat(r)}}return t},[]),T=(e,t,r)=>{const n={};return r.filter(t=>{return!!Array.isArray(t[e])||(void 0!==t[e]&&(r=`Helmet: ${e} should be of type "Array". Instead found type "${typeof t[e]}"`,console&&"function"==typeof console.warn&&console.warn(r)),!1);var r}).map(t=>t[e]).reverse().reduce((e,r)=>{const s={};r.filter(e=>{let r;const o=Object.keys(e);for(let n=0;n<o.length;n+=1){const s=o[n],i=s.toLowerCase();-1===t.indexOf(i)||"rel"===r&&"canonical"===e[r].toLowerCase()||"rel"===i&&"stylesheet"===e[i].toLowerCase()||(r=i),-1===t.indexOf(s)||"innerHTML"!==s&&"cssText"!==s&&"itemprop"!==s||(r=s)}if(!r||!e[r])return!1;const i=e[r].toLowerCase();return n[r]||(n[r]={}),s[r]||(s[r]={}),!n[r][i]&&(s[r][i]=!0,!0)}).reverse().forEach(t=>e.push(t));const o=Object.keys(s);for(let e=0;e<o.length;e+=1){const t=o[e],r={...n[t],...s[t]};n[t]=r}return e},[]).reverse()},y=e=>Array.isArray(e)?e.join(""):e,b=[i.NOSCRIPT,i.SCRIPT,i.STYLE],f=(e,t=!0)=>!1===t?String(e):String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;"),g=e=>Object.keys(e).reduce((t,r)=>{const n=void 0!==e[r]?`${r}="${e[r]}"`:""+r;return t?`${t} ${n}`:n},""),A=(e,t={})=>Object.keys(e).reduce((t,r)=>(t[l[r]||r]=e[r],t),t),C=(t,r,n)=>{switch(t){case i.TITLE:return{toComponent:()=>((t,r,n)=>{const s=A(n,{key:r,"data-rh":!0});return[e.createElement(i.TITLE,s,r)]})(0,r.title,r.titleAttributes),toString:()=>((e,t,r,n)=>{const s=g(r),o=y(t);return s?`<${e} data-rh="true" ${s}>${f(o,n)}</${e}>`:`<${e} data-rh="true">${f(o,n)}</${e}>`})(t,r.title,r.titleAttributes,n)};case"bodyAttributes":case"htmlAttributes":return{toComponent:()=>A(r),toString:()=>g(r)};default:return{toComponent:()=>((t,r)=>r.map((r,n)=>{const s={key:n,"data-rh":!0};return Object.keys(r).forEach(e=>{const t=l[e]||e;"innerHTML"===t||"cssText"===t?s.dangerouslySetInnerHTML={__html:r.innerHTML||r.cssText}:s[t]=r[e]}),e.createElement(t,s)}))(t,r),toString:()=>((e,t,r)=>t.reduce((t,n)=>{const s=Object.keys(n).filter(e=>!("innerHTML"===e||"cssText"===e)).reduce((e,t)=>{const s=void 0===n[t]?t:`${t}="${f(n[t],r)}"`;return e?`${e} ${s}`:s},""),o=n.innerHTML||n.cssText||"",i=-1===b.indexOf(e);return`${t}<${e} data-rh="true" ${s}${i?"/>":`>${o}</${e}>`}`},""))(t,r,n)}}},O=({baseTag:e,bodyAttributes:t,encode:r,htmlAttributes:n,linkTags:s,metaTags:o,noscriptTags:a,scriptTags:l,styleTags:c,title:p="",titleAttributes:d})=>({base:C(i.BASE,e,r),bodyAttributes:C("bodyAttributes",t,r),htmlAttributes:C("htmlAttributes",n,r),link:C(i.LINK,s,r),meta:C(i.META,o,r),noscript:C(i.NOSCRIPT,a,r),script:C(i.SCRIPT,l,r),style:C(i.STYLE,c,r),title:C(i.TITLE,{title:p,titleAttributes:d},r)}),E=e.createContext({}),S=r.shape({setHelmet:r.func,helmetInstances:r.shape({get:r.func,add:r.func,remove:r.func}),document:r.object}),x="undefined"!=typeof document;class I extends t{constructor(e){super(e),this.instances=[],this.value={setHelmet:e=>{this.props.context.helmet=e},helmetInstances:{get:()=>this.instances,add:e=>{this.instances.push(e)},remove:e=>{const t=this.instances.indexOf(e);this.instances.splice(t,1)}}},I.canUseDOM?this.value.document=e.document||document:e.context.helmet=O({baseTag:[],bodyAttributes:{},encodeSpecialCharacters:!0,htmlAttributes:{},linkTags:[],metaTags:[],noscriptTags:[],scriptTags:[],styleTags:[],title:"",titleAttributes:{}})}render(){return e.createElement(E.Provider,{value:this.value},this.props.children)}}I.canUseDOM=x,I.propTypes={context:r.shape({helmet:r.shape()}),children:r.node.isRequired,document:r.object},I.defaultProps={context:{},document:null},I.displayName="HelmetProvider";const L=(e,t,r)=>{const n=e.head||e.querySelector(i.HEAD),s=n.querySelectorAll(t+"[data-rh]"),o=[].slice.call(s),a=[];let l;return r&&r.length&&r.forEach(r=>{const n=e.createElement(t);for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&("innerHTML"===t?n.innerHTML=r.innerHTML:"cssText"===t?n.styleSheet?n.styleSheet.cssText=r.cssText:n.appendChild(e.createTextNode(r.cssText)):n.setAttribute(t,void 0===r[t]?"":r[t]));n.setAttribute("data-rh","true"),o.some((e,t)=>(l=t,n.isEqualNode(e)))?o.splice(l,1):a.push(n)}),o.forEach(e=>e.parentNode.removeChild(e)),a.forEach(e=>n.appendChild(e)),{oldTags:o,newTags:a}},P=(e,t,r)=>{const n=e.getElementsByTagName(t)[0];if(!n)return;const s=n.getAttribute("data-rh"),o=s?s.split(","):[],i=[].concat(o),a=Object.keys(r);for(let e=0;e<a.length;e+=1){const t=a[e],s=r[t]||"";n.getAttribute(t)!==s&&n.setAttribute(t,s),-1===o.indexOf(t)&&o.push(t);const l=i.indexOf(t);-1!==l&&i.splice(l,1)}for(let e=i.length-1;e>=0;e-=1)n.removeAttribute(i[e]);o.length===i.length?n.removeAttribute("data-rh"):n.getAttribute("data-rh")!==a.join(",")&&n.setAttribute("data-rh",a.join(","))},j=(e,t,r)=>{const{baseTag:n,bodyAttributes:s,htmlAttributes:o,linkTags:a,metaTags:l,noscriptTags:c,onChangeClientState:p,scriptTags:d,styleTags:h,title:u,titleAttributes:m}=t;P(e,i.BODY,s),P(e,i.HTML,o),((e,t,r)=>{void 0!==t&&e.title!==t&&(e.title=y(t)),P(e,i.TITLE,r)})(e,u,m);const T={baseTag:L(e,i.BASE,n),linkTags:L(e,i.LINK,a),metaTags:L(e,i.META,l),noscriptTags:L(e,i.NOSCRIPT,c),scriptTags:L(e,i.SCRIPT,d),styleTags:L(e,i.STYLE,h)},b={},f={};Object.keys(T).forEach(e=>{const{newTags:t,oldTags:r}=T[e];t.length&&(b[e]=t),r.length&&(f[e]=T[e].oldTags)}),r&&r(),p(t,b,f)};let v=null;class w extends t{constructor(...e){super(...e),this.rendered=!1}shouldComponentUpdate(e){return!o(e,this.props)}componentDidUpdate(){this.emitChange()}componentWillUnmount(){const{helmetInstances:e}=this.props.context;e.remove(this),this.emitChange()}emitChange(){const{helmetInstances:e,setHelmet:t,document:r}=this.props.context;let n=null;const s=(o=e.get().map(e=>{const t={...e.props};return delete t.context,t}),{baseTag:m(["href"],o),bodyAttributes:u("bodyAttributes",o),defer:p(o,"defer"),encode:p(o,"encodeSpecialCharacters"),htmlAttributes:u("htmlAttributes",o),linkTags:T(i.LINK,["rel","href"],o),metaTags:T(i.META,["name","charset","http-equiv","property","itemprop"],o),noscriptTags:T(i.NOSCRIPT,["innerHTML"],o),onChangeClientState:h(o),scriptTags:T(i.SCRIPT,["src","innerHTML"],o),styleTags:T(i.STYLE,["cssText"],o),title:d(o),titleAttributes:u("titleAttributes",o)});var o;I.canUseDOM?((e,t)=>{const r=e.defaultView;v&&r.cancelAnimationFrame(v),t.defer?v=r.requestAnimationFrame(()=>{j(e,t,()=>{v=null})}):(j(e,t),v=null)})(r,s):O&&(n=O(s)),t(n)}init(){if(this.rendered)return;this.rendered=!0;const{helmetInstances:e}=this.props.context;e.add(this),this.emitChange()}render(){return this.init(),null}}w.propTypes={context:S.isRequired},w.displayName="HelmetDispatcher";class $ extends t{shouldComponentUpdate(e){return!n(this.props,e)}mapNestedChildrenToProps(e,t){if(!t)return null;switch(e.type){case i.SCRIPT:case i.NOSCRIPT:return{innerHTML:t};case i.STYLE:return{cssText:t};default:throw new Error(`<${e.type} /> elements are self-closing and can not contain children. Refer to our API for more information.`)}}flattenArrayTypeChildren({child:e,arrayTypeChildren:t,newChildProps:r,nestedChildren:n}){return{...t,[e.type]:[...t[e.type]||[],{...r,...this.mapNestedChildrenToProps(e,n)}]}}mapObjectTypeChildren({child:e,newProps:t,newChildProps:r,nestedChildren:n}){switch(e.type){case i.TITLE:return{...t,[e.type]:n,titleAttributes:{...r}};case i.BODY:return{...t,bodyAttributes:{...r}};case i.HTML:return{...t,htmlAttributes:{...r}};default:return{...t,[e.type]:{...r}}}}mapArrayTypeChildrenToProps(e,t){let r={...t};return Object.keys(e).forEach(t=>{r={...r,[t]:e[t]}}),r}warnOnInvalidChildren(e,t){return s(a.some(t=>e.type===t),"function"==typeof e.type?"You may be attempting to nest <Helmet> components within each other, which is not allowed. Refer to our API for more information.":`Only elements types ${a.join(", ")} are allowed. Helmet does not support rendering <${e.type}> elements. Refer to our API for more information.`),s(!t||"string"==typeof t||Array.isArray(t)&&!t.some(e=>"string"!=typeof e),`Helmet expects a string as a child of <${e.type}>. Did you forget to wrap your children in braces? ( <${e.type}>{\`\`}</${e.type}> ) Refer to our API for more information.`),!0}mapChildrenToProps(t,r){let n={};return e.Children.forEach(t,e=>{if(!e||!e.props)return;const{children:t,...s}=e.props,o=Object.keys(s).reduce((e,t)=>(e[c[t]||t]=s[t],e),{});let{type:a}=e;switch("symbol"==typeof a?a=a.toString():this.warnOnInvalidChildren(e,t),a){case i.FRAGMENT:r=this.mapChildrenToProps(t,r);break;case i.LINK:case i.META:case i.NOSCRIPT:case i.SCRIPT:case i.STYLE:n=this.flattenArrayTypeChildren({child:e,arrayTypeChildren:n,newChildProps:o,nestedChildren:t});break;default:r=this.mapObjectTypeChildren({child:e,newProps:r,newChildProps:o,nestedChildren:t})}}),this.mapArrayTypeChildrenToProps(n,r)}render(){const{children:t,...r}=this.props;let n={...r};return t&&(n=this.mapChildrenToProps(t,n)),e.createElement(E.Consumer,null,t=>e.createElement(w,Object.assign({},n,{context:t})))}}$.propTypes={base:r.object,bodyAttributes:r.object,children:r.oneOfType([r.arrayOf(r.node),r.node]),defaultTitle:r.string,defer:r.bool,encodeSpecialCharacters:r.bool,htmlAttributes:r.object,link:r.arrayOf(r.object),meta:r.arrayOf(r.object),noscript:r.arrayOf(r.object),onChangeClientState:r.func,script:r.arrayOf(r.object),style:r.arrayOf(r.object),title:r.string,titleAttributes:r.object,titleTemplate:r.string},$.defaultProps={defer:!0,encodeSpecialCharacters:!0},$.displayName="Helmet";export{$ as Helmet,I as HelmetProvider};
//# sourceMappingURL=index.modern.js.map
